<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Gestione Carosello Live</title>
<style>
body { font-family: Arial; background: #1e1e1e; color: #fff; margin:0; padding:30px; }
h1 { text-align:center; }
form { background:#2b2b2b; padding:20px; border-radius:12px; margin-bottom:30px; }
input[type="text"], textarea { width:100%; padding:8px; border:none; border-radius:8px; margin:8px 0; }
input[type="file"] { margin:10px 0; }
button { background:#007bff; color:white; border:none; padding:10px 18px; border-radius:8px; cursor:pointer; font-weight:bold; }
button:hover { background:#0056b3; }
table { width:100%; border-collapse:collapse; }
th,td { text-align:left; padding:8px; border-bottom:1px solid #444; }
tr:hover { background:#333; }
.preview-img { max-height:80px; border-radius:8px; }
</style>
</head>
<body>
<h1>Gestione Carosello Live</h1>

<form action="/upload" method="post" enctype="multipart/form-data">
  <h2>Testo principale</h2>
  <textarea name="text" rows="3" placeholder="Inserisci il testo principale..."></textarea>

  <h2>Carica immagini o logo</h2>
  <input type="file" name="images" multiple accept="image/*">
  <p>Puoi caricare pi√π immagini, oppure il logo (rinomina <b>logo.png</b> se vuoi usarlo come overlay)</p>

  <button type="submit">üì§ Carica contenuti</button>
</form>

<h2>üìÅ File attuali</h2>
<table id="fileTable">
  <thead>
    <tr>
      <th>Anteprima</th>
      <th>Nome file</th>
      <th>Dimensione</th>
      <th>Azioni</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
async function loadFiles() {
  const res = await fetch('/api/files');
  const files = await res.json();
  const tbody = document.querySelector('#fileTable tbody');
  tbody.innerHTML = '';
  for (const f of files) {
    const tr = document.createElement('tr');
    const isImage = /\.(jpg|jpeg|png|gif)$/i.test(f.name);
    tr.innerHTML = `
      <td>${isImage ? `<img src="/content/${f.name}" class="preview-img">` : 'üìÑ'}</td>
      <td>${f.name}</td>
      <td>${(f.size/1024).toFixed(1)} KB</td>
      <td><button onclick="deleteFile('${f.name}')">‚ùå Elimina</button></td>
    `;
    tbody.appendChild(tr);
  }
}
async function deleteFile(name) {
  if(!confirm(`Vuoi davvero eliminare ${name}?`)) return;
  const res = await fetch('/api/files/' + name, { method: 'DELETE' });
  if(res.ok) loadFiles(); else alert('Errore durante eliminazione');
}
loadFiles();
</script>
</body>
</html>
